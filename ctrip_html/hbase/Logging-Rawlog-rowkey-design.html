<!DOCTYPE html>
<html>
<head>

<title> Logging Rawlogrowkey</title>
<meta http-equiv="Content-Type" content="text/html; charset=cp936">

<script type="text/javascript" src="../js/jquery-1.6.4.min.js"></script>

<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shCore.css">
<link rel="Stylesheet" type="text/css" href="../js/sh/styles/shThemeRDark.css">
<script type="text/javascript" src="../js/sh/scripts/shCore.js"></script>
<script type="text/javascript" src="../js/sh/scripts/shAutoloader.js"></script>

<script type="text/javascript" src="../js/main.js"></script>

<link rel="Stylesheet" type="text/css" href="../style.css">
<link rel="Stylesheet" type="text/css" href="../css/main.css">

</head>
<body>
	<div class="hidden">
		<input id="root_path" type="text" value="../">
	</div>
	<div id="body-wrapper">
		<div id="container">
			<div id="top">
				<div id="page-title">
					<a href="../index.html">CTRIP</a>
				</div>
				<ul id="top-nav">
				</ul>
			</div>
			<div id="middle">
				

<h1 id="toc_1"> Logging Rawlogrowkey</h1>

<div class="toc">
<ul>
<li><a href="#toc_1"> Logging Rawlogrowkey</a>
<ul>
<li><a href="#toc_1.1">1 ĿǰRawlog</a>
<li><a href="#toc_1.2">2 </a>
<ul>
<li><a href="#toc_1.2.1">2.1 Ԥregion</a>
<li><a href="#toc_1.2.2">2.2 ʵ㹻ɢдregionƽд</a>
<li><a href="#toc_1.2.3">2.3 </a>
</ul>
</ul>
</ul>
</div>
<h2 id="toc_1.1">1 ĿǰRawlog</h2>
<ol>
<li>
regionӴ󣬿region ʴ

<ul>
<li>
12791region

<li>
11409region, Ϊ89.19%

<li>
ʣregionСҲǼȲ⣬region 287G, &lt;1mregion129

</ul>
<li>
д

<ul>
<li>
еrowkeyƣ˵appid+date˳

<li>
˵ÿappidһдȵ㣬ⲻûõֲʽŵ㣬ἫĽhbaseȺķ

<li>
ͬ⣬һζϻἯһregionϣscanǺõģĿǰеlogѯǻmutigetģɢܺá

</ul>
</ol>
 
<h2 id="toc_1.2">2 </h2>
<p>
еlogѯ
</p>
<ol>
<li>
logindexȡlogrowkey

<li>
rowkeyʹmutigetȡlog

</ol>

<p>
ԲҪ˳rowkeyơ
</p>

<ol>
<li>
regionӴ

<ul>
<li>
ʹԤֵregion

<li>
ʵԤֳ㹻region, ֤ٵĳsplit

</ul>
<li>
regionʣС⣬д

<ul>
<li>
Щһ

<li>
дʱ㹻ɢеģƽдЩregion

<li>
״̬¸regionСȫһ

<li>
д״̬Ҳһ

<li>
ԼsplitĴ״̬²ٳ֣ͬ˸ñregionblanceֵĴ״̬²֡

</ul>
</ol>
 
<p>
ڽиǣݽ֧֣һȫµļȺһᣬԲݵǨƣʱȪӦòУǨݣ
</p>

<h3 id="toc_1.2.1">2.1 Ԥregion</h3>
<ol>
<li>
ĿǰrawlogĴСΪ2938.5G Ҳ3T7

<li>
ǵԺ10TΪ洢Ŀ꣬һregion2G Ԥ5000region

</ol>

<h3 id="toc_1.2.2">2.2 ʵ㹻ɢдregionƽд</h3>
<ol>
<li>
ϿԶregionдһlog, ѭһٴδͷѭԴﵽƽ

<li>
ʵʽ, һrowkeyṹ

</ol>
<table>
<tr>
<th>
hashcode
</th>
<th>
unique-id
</th>
</tr>
<tr>
<td>
1 ~ 100000
</td>
<td>
appid + hostip + timestamp + logid
</td>
</tr>
</table>

<ol>
<li>
ͨýǶȣrowkey Ϊ

<ol>
<li>
<strong>hashcode</strong>: ɢֵڽɢеregion

<li>
<strong>unique-id</strong>: ݵһΨһid, Ϻҵ

</ol>
<li>
rowlog

<ol>
<li>
<strong>hashcode</strong>: һ1 ~ 100000intֵ

<li>
<strong>unique-id</strong>: һappid + hostip + timestamp + logid ɵΨһid, Ҳеrowkey

</ol>
<li>
Ԥ5000region, ÿregionռ20ɢֵ(startKey-endKey)1-20, 21-40, .... 99981-100000

</ol>


<h3 id="toc_1.2.3">2.3 </h3>
<ol>
<li>
ֻҪ޸writerrowlogrowkeyɲ

<li>
طȫ͸

<li>
ĻֻҪСʱ㹻ˣֹ֧ˡ

<li>
λȡһloghashcode, мַ:

<ol>
<li>
writerÿһlogԵ1000001

<li>
Ҳÿȡ1-100000ֵЧ

<li>
Ϊȥ1-20д 

<ol>
<li>
Էһint[100000],shuffle1-100000ֵ

<li>
ÿһlogȡһֵint[i++]

<li>
βֱӴͷȡshuffleٴͷȡ

<li>
һʼԤshuffleü飬á

</ol>
</ol>
</ol>

			</div>

			<div id="bottom">
				&copy; 2012 王兴朝
			</div>
		</div>
	<div>
</body>
</html>
